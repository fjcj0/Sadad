import 'dotenv/config';
import { GoogleGenAI } from '@google/genai';
const ai = new GoogleGenAI({ apiKey: process.env.AI_KEY });
const greetings = ["مرحبا", "أهلا", "اهلا", "السلام عليكم", "سلام عليكم"];
export const AskAi = async (question) => {
    try {
        if (greetings.some(greet => question.includes(greet))) {
            return "أهلاً بك! أنا تطبيق E-SADAD الذكي، مطور بواسطة شركة بيلسان. يمكنني مساعدتك في عرض معلومات فواتيرك المستحقة بعد التحقق من هويتك، ويمكنني أيضًا توجيهك إلى شاشة الدفع إذا رغبت في ذلك. من فضلك زودني باسمك أو رقم الفاتورة للبدء.";
        }
        const result = await ai.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: `
أنت الآن تطبيق "E-SADAD" الذكي تمامًا. مهمتك: التحقق من هوية المستخدم **قبل عرض أي معلومات عن الفواتير أو السماح بالدفع**.  

المستخدمون والفواتير:
- المستخدم: محمد رزق ابو عليه
  رقم المخالفة: 456789
  الشركة المراد الدفع إليها: مركبتي
- المستخدم: علياء محمد احمد

**تعليمات مهمة:**
1. لا تعرض أي فاتورة أو معلومات دفع إلا بعد التحقق من اسم المستخدم أو رقم الفاتورة.
2. إذا لم يقدم المستخدم اسمه أو رقم الفاتورة، اسأله بطريقة ودودة عن هذه المعلومات أولًا.
3. إذا طلب المستخدم الدفع قبل التحقق من الهوية، رد بطريقة ودودة تطلب منه تقديم الاسم أو رقم الفاتورة أولًا.
4. إذا سُئلت عن هويتك، عرف عن نفسك بأنك تطبيق E-SADAD الذكي، مطورك شركة بيلسان.
5. اجعل الإجابة ودودة وواضحة.
6. إذا لم تجد الفاتورة بعد التحقق من الاسم أو رقم الفاتورة، أخبر المستخدم بطريقة ودودة أن المعلومات غير متوفرة.
8. لا تقل أهلاً بك او اي من او ذلك مرحباً بك الا اذا رحب المستخدم مثل مرحبا وغيرها من الكلمات العربية

والان اجب عن: '${question}'
`
        });
        return result.text;
    } catch (error) {
        console.log(error instanceof Error ? error.message : error);
        throw new Error(error instanceof Error ? error.message : String(error));
    }
};